<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste da Extens√£o Opa&SGP</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .dialog_panel {
            border: 2px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .botoes {
            margin-top: 10px;
        }
        .chat {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .notif {
            display: inline-block;
            margin-left: 10px;
        }
        .notif i.notifica {
            color: red;
            font-weight: bold;
        }
        .data_hora_ultima_msg {
            font-size: 12px;
            color: #666;
        }
        .list {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste da Extens√£o Opa&SGP</h1>
    
    <div class="test-container">
        <h2>üìã Status dos M√≥dulos</h2>
        <div id="module-status"></div>
    </div>

    <div class="test-container">
        <h2>üîß Testes de Funcionalidade</h2>
        <button class="test-button" onclick="testSgpButton()">Testar Bot√£o SGP</button>
        <button class="test-button" onclick="testFastTransfer()">Testar Transfer√™ncia R√°pida</button>
        <button class="test-button" onclick="testMessageTemplates()">Testar Templates de Mensagem</button>
        <button class="test-button" onclick="testBetterNotifications()">Testar Notifica√ß√µes Aprimoradas</button>
        <button class="test-button" onclick="clearTests()">Limpar Testes</button>
    </div>

    <div class="test-container">
        <h2>üé≠ Simula√ß√£o de Interface Opa!</h2>
        
        <!-- Simula√ß√£o de painel de atendimento -->
        <div class="dialog_panel">
            <h3>Painel de Atendimento</h3>
            <p>Cliente ID: <span class="client-id">12345</span></p>
            <div class="botoes">
                <button>Bot√£o Original</button>
                <!-- Aqui devem aparecer os bot√µes da extens√£o -->
            </div>
        </div>

        <!-- Simula√ß√£o de lista de chats -->
        <div class="list">
            <div class="chat" data-id="chat1">
                <strong>Cliente Jo√£o</strong>
                <span class="notif">
                    <i class="notifica">üîî</i>
                </span>
                <div class="data_hora_ultima_msg">10:30</div>
            </div>
            <div class="chat" data-id="chat2">
                <strong>Cliente Maria</strong>
                <span class="notif">
                    <i class="notifica">üîî</i>
                </span>
                <div class="data_hora_ultima_msg">10:25</div>
            </div>
            <div class="chat" data-id="chat3">
                <strong>Cliente Pedro</strong>
                <div class="data_hora_ultima_msg">10:20</div>
            </div>
        </div>

        <!-- Simula√ß√£o de modal de observa√ß√£o -->
        <div id="observation-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 2px solid #007bff; border-radius: 8px; z-index: 1000;">
            <h3>Nova Observa√ß√£o</h3>
            <form name="new_atendimentoObservacao">
                <div class="form-group">
                    <label>Mensagem:</label>
                    <textarea name="mensagem" rows="4" cols="50" placeholder="Digite sua observa√ß√£o..."></textarea>
                </div>
                <div class="botoes">
                    <button type="button" onclick="closeObservationModal()">Cancelar</button>
                    <button type="submit">Salvar</button>
                </div>
            </form>
        </div>
        
        <button class="test-button" onclick="openObservationModal()">Abrir Modal de Observa√ß√£o</button>
    </div>

    <div class="test-container">
        <h2>üìä Logs da Extens√£o</h2>
        <div id="extension-logs" style="background: #f8f9fa; padding: 10px; border-radius: 4px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        // Interceptar console.log para mostrar logs da extens√£o
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToLogs(message, type = 'log') {
            const logsDiv = document.getElementById('extension-logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLogs(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLogs(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLogs(args.join(' '), 'warn');
        };

        // Verificar status dos m√≥dulos
        function checkModuleStatus() {
            const statusDiv = document.getElementById('module-status');
            const modules = [
                { name: 'Utils', check: () => window.__opaUtils },
                { name: 'SGP Integration', check: () => window.__opaSgpInjected },
                { name: 'Fast Transfer', check: () => window.__opaFastTransferInjected },
                { name: 'Message Templates', check: () => window.__opaMessageTemplatesInjected },
                { name: 'Better Notifications', check: () => window.__opaBetterNotificationsInjected }
            ];
            
            statusDiv.innerHTML = '';
            
            modules.forEach(module => {
                const div = document.createElement('div');
                div.className = 'status';
                
                if (module.check()) {
                    div.classList.add('success');
                    div.textContent = `‚úÖ ${module.name}: Carregado`;
                } else {
                    div.classList.add('warning');
                    div.textContent = `‚ö†Ô∏è ${module.name}: N√£o carregado`;
                }
                
                statusDiv.appendChild(div);
            });
        }

        // Testes de funcionalidade
        function testSgpButton() {
            console.log('üß™ Testando bot√£o SGP...');
            const sgpButton = document.querySelector('[data-sgp-button]');
            if (sgpButton) {
                console.log('‚úÖ Bot√£o SGP encontrado!');
                sgpButton.click();
            } else {
                console.log('‚ùå Bot√£o SGP n√£o encontrado');
            }
        }

        function testFastTransfer() {
            console.log('üß™ Testando transfer√™ncia r√°pida...');
            const fastTransferButton = document.querySelector('.fast-transfer-button');
            if (fastTransferButton) {
                console.log('‚úÖ Bot√£o de transfer√™ncia encontrado!');
                fastTransferButton.click();
            } else {
                console.log('‚ùå Bot√£o de transfer√™ncia n√£o encontrado');
            }
        }

        function testMessageTemplates() {
            console.log('üß™ Testando templates de mensagem...');
            openObservationModal();
            setTimeout(() => {
                const templates = document.querySelectorAll('.message-template-btn');
                if (templates.length > 0) {
                    console.log(`‚úÖ ${templates.length} templates encontrados!`);
                    templates[0].click();
                } else {
                    console.log('‚ùå Templates de mensagem n√£o encontrados');
                }
            }, 500);
        }

        function testBetterNotifications() {
            console.log('üß™ Testando notifica√ß√µes aprimoradas...');
            const enhancedChats = document.querySelectorAll('.chat.notification-enhanced');
            if (enhancedChats.length > 0) {
                console.log(`‚úÖ ${enhancedChats.length} chats com notifica√ß√µes aprimoradas encontrados!`);
            } else {
                console.log('‚ùå Notifica√ß√µes aprimoradas n√£o encontradas');
            }
        }

        function openObservationModal() {
            document.getElementById('observation-modal').style.display = 'block';
        }

        function closeObservationModal() {
            document.getElementById('observation-modal').style.display = 'none';
        }

        function clearTests() {
            document.getElementById('extension-logs').innerHTML = '';
            console.log('üßπ Logs limpos');
        }

        // Verificar status inicial
        setTimeout(checkModuleStatus, 1000);
        
        // Verificar status periodicamente
        setInterval(checkModuleStatus, 5000);
        
        console.log('üöÄ P√°gina de teste carregada');
    </script>
</body>
</html>
